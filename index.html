<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل بث مباشر متكامل</title>
    <style>
        /* الأساسيات */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #fff;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f8b133;
            padding: 10px 20px;
        }

        header .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        header button {
            background: #444;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        header button:hover {
            background: #666;
        }

        /* التصميم الرئيسي */
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding: 20px;
        }

        .card {
            background-color: #1e1e1e;
            border-radius: 10px;
            overflow: hidden;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
            position: relative;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            cursor: pointer;
        }

        .card p {
            padding: 10px;
            font-size: 1rem;
        }

        .rating span {
            font-size: 1.5rem;
            color: gold;
            cursor: pointer;
            margin: 0 2px;
        }

        .signal-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            background-color: black;
        }

        button.close-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            z-index: 1000;
        }

        button.close-btn:hover {
            background-color: #d32f2f;
        }

        input#searchBar {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
        }

        body.dark-mode {
            background-color: #000;
            color: #fff;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">مشغل بث مباشر</div>
        <button onclick="toggleTheme()">تبديل الوضع</button>
    </header>

    <input id="searchBar" onkeyup="filterStreams()" placeholder="ابحث عن قناة...">

    <div class="container" id="streamsContainer">
        <!-- سيتم تحميل البثوص هنا -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const streamsUrl = "https://example.com/streams.json"; // رابط لملف JSON أو API
        const container = document.getElementById("streamsContainer");

        // تحميل القنوات ديناميكيًا
        async function loadStreams() {
            try {
                const response = await fetch(streamsUrl);
                const streams = await response.json();
                populateStreams(streams);
            } catch (error) {
                console.error("خطأ في تحميل القنوات:", error);
            }
        }

        // إنشاء بطاقات البث
        function populateStreams(streams) {
            streams.forEach(stream => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <div class="signal-indicator"></div>
                    <img src="${stream.thumbnail}" alt="${stream.title}" onclick="playStream('${stream.url}', '${stream.title}')">
                    <p>${stream.title}</p>
                    <div class="rating">
                        <span onclick="rateStream(5)">★</span>
                        <span onclick="rateStream(4)">★</span>
                        <span onclick="rateStream(3)">★</span>
                        <span onclick="rateStream(2)">★</span>
                        <span onclick="rateStream(1)">★</span>
                    </div>
                `;
                container.appendChild(card);
                checkSignal(stream.url, card.querySelector(".signal-indicator"));
            });
        }

        // تصفية القنوات
        function filterStreams() {
            const query = document.getElementById("searchBar").value.toLowerCase();
            const cards = document.querySelectorAll(".card");
            cards.forEach(card => {
                const title = card.querySelector("p").textContent.toLowerCase();
                card.style.display = title.includes(query) ? "" : "none";
            });
        }

        // تشغيل البث
        function playStream(url, title) {
            const video = document.createElement("video");
            video.controls = true;

            // إعداد الفيديو
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
            } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
                video.src = url;
            } else {
                alert("البث غير مدعوم.");
                return;
            }

            document.body.appendChild(video);

            // زر الإغلاق
            const closeButton = document.createElement("button");
            closeButton.className = "close-btn";
            closeButton.textContent = "إغلاق";
            closeButton.onclick = () => {
                video.pause();
                video.remove();
                closeButton.remove();
            };
            document.body.appendChild(closeButton);

            video.play();
        }

        // تقييم القناة
        function rateStream(rating) {
            alert(`تم التقييم: ${rating} نجوم!`);
        }

        // فحص جودة البث
        function checkSignal(url, indicator) {
            fetch(url, { method: "HEAD" })
                .then(response => {
                    indicator.style.backgroundColor = response.ok ? "green" : "red";
                })
                .catch(() => {
                    indicator.style.backgroundColor = "gray";
                });
        }

        // تبديل الوضع الليلي
        function toggleTheme() {
            document.body.classList.toggle("dark-mode");
        }

        loadStreams();
    </script>
</body>
</html>
