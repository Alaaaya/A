<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مشغل القنوات الديناميكي</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .player-container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .channel-groups {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .group-btn {
      padding: 8px 15px;
      background: #e0e0e0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .group-btn:hover, .group-btn.active {
      background: #4CAF50;
      color: white;
    }
    
    .channel-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .channel-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .channel-item:hover {
      background: #f0f0f0;
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .channel-item img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 8px;
      border-radius: 50%;
    }
    
    .channel-item .name {
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .video-container {
      width: 100%;
      background: black;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 20px;
    }
    
    video {
      width: 100%;
      display: block;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    
    @media (max-width: 768px) {
      .channel-list {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
  <div class="player-container">
    <div class="header">
      <h1>مشغل القنوات الديناميكي</h1>
    </div>
    
    <div class="channel-groups" id="channelGroups">
      <!-- Groups will be added dynamically -->
    </div>
    
    <div class="channel-list" id="channelList">
      <div class="loading">جاري تحميل القنوات...</div>
    </div>
    
    <div class="video-container">
      <video id="video" controls autoplay></video>
    </div>
  </div>

  <script>
    const listUrl = "https://gist.githubusercontent.com/Alaaaya/a29676eabff1cadb64105f770ccc9102/raw/d01c503f88ba7a0d48f82c1bac471bb198bf941e/gistfile1.txt";
    const video = document.getElementById('video');
    const channelGroups = document.getElementById('channelGroups');
    const channelList = document.getElementById('channelList');
    
    let allChannels = [];
    let currentGroup = null;
    
    function playStream(url) {
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', function() {
          video.play();
        });
      } else {
        alert("متصفحك لا يدعم تشغيل هذه القناة.");
      }
    }
    
    function loadChannels() {
      channelList.innerHTML = '<div class="loading">جاري تحميل القنوات...</div>';
      
      fetch(listUrl)
        .then(res => res.text())
        .then(text => {
          const lines = text.split('\n');
          allChannels = [];
          let currentChannel = null;
          
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            if (line.startsWith('#EXTINF')) {
              const groupTitleMatch = line.match(/group-title="([^"]*)"/);
              const groupTitle = groupTitleMatch ? groupTitleMatch[1] : 'أخرى';
              const name = line.split(',')[1] || 'بدون اسم';
              
              currentChannel = {
                name,
                group: groupTitle,
                url: '',
                logo: 'https://via.placeholder.com/60?text=TV'
              };
            }
            else if (currentChannel && line.startsWith('http')) {
              currentChannel.url = line;
              allChannels.push(currentChannel);
              currentChannel = null;
            }
            else if (currentChannel && (line.endsWith('.png') || line.endsWith('.jpg'))) {
              currentChannel.logo = line;
            }
          }
          
          if (allChannels.length === 0) {
            channelList.innerHTML = '<div class="error">لا توجد قنوات متاحة</div>';
            return;
          }
          
          // Create group buttons
          const groups = [...new Set(allChannels.map(ch => ch.group))];
          channelGroups.innerHTML = '';
          
          groups.forEach(group => {
            const btn = document.createElement('button');
            btn.className = 'group-btn';
            btn.textContent = group;
            btn.addEventListener('click', () => filterByGroup(group));
            channelGroups.appendChild(btn);
          });
          
          // Show all channels by default
          filterByGroup(groups[0]);
        })
        .catch(err => {
          console.error('Error loading channels:', err);
          channelList.innerHTML = '<div class="error">فشل في تحميل القنوات</div>';
        });
    }
    
    function filterByGroup(group) {
      currentGroup = group;
      const filteredChannels = allChannels.filter(ch => ch.group === group);
      
      // Update active group button
      document.querySelectorAll('.group-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === group);
      });
      
      // Render channels
      channelList.innerHTML = '';
      
      if (filteredChannels.length === 0) {
        channelList.innerHTML = '<div class="error">لا توجد قنوات في هذه المجموعة</div>';
        return;
      }
      
      filteredChannels.forEach(channel => {
        const item = document.createElement('div');
        item.className = 'channel-item';
        item.innerHTML = `
          <img src="${channel.logo}" alt="${channel.name}" onerror="this.src='https://via.placeholder.com/60?text=TV'">
          <div class="name">${channel.name}</div>
        `;
        item.addEventListener('click', () => playStream(channel.url));
        channelList.appendChild(item);
      });
      
      // Play first channel in group
      if (filteredChannels[0].url) {
        playStream(filteredChannels[0].url);
      }
    }
    
    // Load channels when page loads
    document.addEventListener('DOMContentLoaded', loadChannels);
  </script>
</body>
</html>