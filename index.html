<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- ... (أبقى جزء الـ head كما هو تماماً) ... -->
</head>
<body>
    <div class="container">
        <!-- ... (أبقى الأجزاء الثابتة كما هي) ... -->
        
        <div id="dynamicSections"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // ... (أبقى المتغيرات والدوال المساعدة كما هي) ...
            
            // دالة لتحميل القنوات مع حلول بديلة
            async function loadChannels() {
                try {
                    // المحاولة الأولى: جلب القنوات من الرابط الأصلي
                    await loadChannelsFromJSON('https://jzu4.github.io/files/json/rives.json');
                    
                    // إذا لم يتم تحميل أي قنوات (المصفوفة فارغة)
                    if (allChannels.length === 0) {
                        throw new Error('لم يتم تحميل أي قنوات');
                    }
                } catch (error) {
                    console.error('فشل تحميل القنوات من المصدر الأول:', error);
                    
                    try {
                        // المحاولة الثانية: جلب من نسخة احتياطية
                        await loadChannelsFromJSON('https://raw.githubusercontent.com/jzu4/jzu4.github.io/main/files/json/rives.json');
                        
                        if (allChannels.length === 0) {
                            // المحاولة الثالثة: استخدام قنوات افتراضية مدمجة
                            loadDefaultChannels();
                        }
                    } catch (fallbackError) {
                        console.error('فشل تحميل القنوات من المصدر الاحتياطي:', fallbackError);
                        loadDefaultChannels();
                    }
                }
            }
            
            // دالة لتحميل القنوات من JSON
            async function loadChannelsFromJSON(url) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('فشل في جلب البيانات');
                    
                    const data = await response.json();
                    if (!data.channels || !Array.isArray(data.channels)) throw new Error('هيكل JSON غير صحيح');
                    
                    // تصنيف القنوات حسب الفئة
                    const categories = {};
                    data.channels.forEach(channel => {
                        if (!channel.category || !channel.url) return;
                        
                        if (!categories[channel.category]) {
                            categories[channel.category] = [];
                        }
                        categories[channel.category].push(channel);
                    });
                    
                    // إنشاء الأقسام ديناميكياً
                    createDynamicSections(categories);
                    
                } catch (error) {
                    console.error('حدث خطأ في تحميل القنوات:', error);
                    throw error; // نعيد رمي الخطأ للتعامل معه في الدالة الأم
                }
            }
            
            // دالة لتحميل قنوات افتراضية عند فشل جميع المصادر
            function loadDefaultChannels() {
                const defaultChannels = {
                    "أخبار": [
                        {
                            name: "الجزيرة",
                            url: "https://live-hls-web-aja.getaj.net/AJA/index.m3u8",
                            logo: "https://iconape.com/wp-content/files/kt/20448/png/Aljazeera-01.png"
                        },
                        {
                            name: "العربية",
                            url: "https://av.alarabiya.net/alarabiapublish/alarabiya.smil/playlist.m3u8",
                            logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Al-Arabiya_new_logo.svg/2560px-Al-Arabiya_new_logo.svg.png"
                        }
                    ],
                    "رياضية": [
                        {
                            name: "بي إن سبورت 1",
                            url: "https://stream.sainaertebat.com/hls2/bein1.m3u8",
                            logo: "https://jzu4.github.io/files/img/IMG_6703.png"
                        }
                    ]
                };
                
                createDynamicSections(defaultChannels);
                dynamicSections.innerHTML += '<p style="color: #ff6b6b; text-align: center;">يتم عرض قنوات افتراضية بسبب مشكلة في التحميل</p>';
            }
            
            // دالة لإنشاء الأقسام ديناميكياً
            function createDynamicSections(categories) {
                dynamicSections.innerHTML = '';
                
                for (const [category, channels] of Object.entries(categories)) {
                    const section = document.createElement('div');
                    section.innerHTML = `
                        <div class="section-title">${category}</div>
                        <div class="channel-grid" id="${category.replace(/\s+/g, '-')}-grid"></div>
                    `;
                    dynamicSections.appendChild(section);
                    
                    const grid = section.querySelector('.channel-grid');
                    channels.forEach(channel => {
                        const card = createChannelCard(channel);
                        grid.appendChild(card);
                        allChannels.push(card);
                    });
                }
                
                if (allChannels.length > 0) {
                    setActiveChannel(allChannels[0]);
                }
                
                updateFavoritesDisplay();
            }
            
            // ... (أبقى بقية الدوال كما هي) ...
            
            // تهيئة التطبيق
            function initialize() {
                setupSearch();
                setupFullscreen();
                setupThemeToggle();
                setupLanguageToggle();
                loadChannels(); // استبدلنا loadChannelsFromJSON بـ loadChannels
            }
            
            initialize();
        });
    </script>
</body>
</html>