<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>منصة الفيديو - تشغيل ديناميكي</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { font-family: Arial; direction: rtl; background: #f0f0f0; padding: 20px; }
    .series { margin-bottom: 20px; background: #fff; border-radius: 6px; border: 1px solid #ddd; padding: 10px; }
    .series img { width: 100%; height: 300px; object-fit: cover; border-radius: 4px; }
    .series-title { font-weight: bold; font-size: 18px; margin: 10px 0; cursor: pointer; color: #333; }
    .episodes { display: none; margin-top: 10px; }
    .episode { background: #f9f9f9; padding: 8px; margin: 5px 0; border-radius: 4px; cursor: pointer; }
    video { display: block; width: 100%; max-width: 720px; margin: 30px auto; }
  </style>
</head>
<body>

<h2>منصة الفيديو - التشغيل الديناميكي</h2>
<video id="player" controls></video>
<div id="content"></div>

<script>
  const shows = [
    {id: 5436, title: "العتاولة 2", poster: "https://media0075.elcinema.com/uploads/_315x420_c3ea99f1b5458adbc780d65cc5d68a5cf1f54f5b9b05dd75150979a47a50f99e.jpg"},
    {id: 5474, title: "شباب البومب 13", poster: "https://media0075.elcinema.com/uploads/_315x420_f0f39be50f6cf5e4a868de831d3e9fa8bf49ac63d60003c33d2631ec779fb8cd.jpg"},
    {id: 5505, title: "معاوية", poster: "https://media0075.elcinema.com/uploads/_315x420_fc089daaf230008885aeb032cb99a93f1c7bd9c91341570fef79185c1fc4eb83.jpg"}
    // أضف باقي الأعمال هنا
  ];

  const container = document.getElementById("content");
  const player = document.getElementById("player");

  shows.forEach(show => {
    const div = document.createElement("div");
    div.className = "series";
    div.innerHTML = `
      <img src="${show.poster}" alt="${show.title}">
      <div class="series-title" onclick="loadEpisodes(${show.id}, this)">${show.title}</div>
      <div class="episodes" id="eps-${show.id}"></div>
    `;
    container.appendChild(div);
  });

  function loadEpisodes(id, el) {
    const target = document.getElementById(`eps-${id}`);
    if (target.innerHTML.trim() !== "") {
      target.style.display = target.style.display === "none" ? "block" : "none";
      return;
    }

    fetch(`https://todays-video.online/ios/episodes?id=${id}`)
      .then(res => res.json())
      .then(data => {
        if (!data || !data.episodes) {
          target.innerHTML = "<div>لا توجد حلقات متاحة.</div>";
        } else {
          target.innerHTML = data.episodes.map((ep, i) =>
            `<div class="episode" onclick="play('${ep.hls_url}')">حلقة ${i + 1}</div>`
          ).join('');
        }
        target.style.display = "block";
      })
      .catch(err => {
        target.innerHTML = "<div>حدث خطأ أثناء جلب الحلقات.</div>";
        target.style.display = "block";
      });
  }

  function play(url) {
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(player);
      hls.on(Hls.Events.MANIFEST_PARSED, () => player.play());
    } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
      player.src = url;
      player.addEventListener('loadedmetadata', () => player.play());
    }
  }
</script>

</body>
</html>